let characterSave={info:{uuid:"",type:""},name:"",type:"",class:"",apprehension:0,wounds:{fatal:[""],dangers:["",""],pains:["","",""],distractions:["","","",""],annoyances:["","","","",""]},stats:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0},equipment:"",peculiarityPoints:0,statisticalTraining:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0},peculiarityTraining:0,peculiarities:"",recoveringWound:"",weeksRequired:0,skills:[[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]]};document.documentElement.setAttribute("theme","theme-dark"),document.body.onload=getCharacter;const info=Array.from(document.querySelectorAll("#info>input")),apprehension=document.querySelector("#apprehension"),wounds=Array.from(document.querySelectorAll("#wounds>div>textarea")),stats=Array.from(document.querySelectorAll("#stats>div>input")),modifiers=Array.from(document.querySelectorAll("#stats>div>div.modifier")),equipment=document.querySelector("#equipment"),carryWeight=Array.from(document.querySelectorAll("#additional>div.carry-weight")),accumulatedTraining=Array.from(document.querySelectorAll("#prowesses * input")),peculiarities=document.querySelector("#peculiarities"),skillsMod=Array.from(document.querySelectorAll("#skills span.modifier")),skillsPE=Array.from(document.querySelectorAll("#skills label input"));function loadCharacter(e){characterSave=JSON.parse(JSON.stringify(e)),info[0].value=e.type,info[1].value=e.class,info[2].value=e.name,apprehension.value=e.apprehension,wounds.forEach(t=>{t.value=e.wounds[t.parentElement.id][t.getAttribute("index")]}),stats.forEach(t=>{t.value=e.stats[t.id]}),equipment.value=e.equipment,accumulatedTraining[0].value=e.peculiarityPoints;for(let t=1;t<=6;t++)accumulatedTraining[t].value=e.statisticalTraining[accumulatedTraining[t].className];accumulatedTraining[7].value=e.peculiarityTraining,accumulatedTraining[8].value=e.recoveringWound,accumulatedTraining[9].value=e.weeksRequired,peculiarities.value=e.peculiarities,skillsPE.forEach(t=>{let a=t.getAttribute("index").split(" ");t.checked=e.skills[Number(a[0])][Number(a[1])]}),calcStats(),updateTitle()}function calcStats(){let e=[];stats.forEach(t=>{e.push(t.valueAsNumber)}),carryWeight.forEach((t,a)=>{e[2]*(1+.5*a)>a+1?t.innerHTML=Math.floor(e[2]*(1+.5*a)):t.innerHTML=a+1}),e.forEach((t,a)=>{e[a]=modifierMap(t)}),modifiers.forEach((t,a)=>{let r="";e[a]>0&&(r+="+"),r+=e[a],t.innerHTML=r}),skillsMod.forEach((t,a)=>{let r="";bonusMap(e,a)>0&&(r+="+"),r+=bonusMap(e,a),t.innerHTML=r})}function modifierMap(e){switch(e){case-7:case-6:return-8;case-5:return-7;case-4:case-3:return-6;case-2:case-1:return-5;case 0:return-4;case 1:return-3;case 2:case 3:return-2;case 4:return-1;case 5:return 0;case 6:return 1;case 7:case 8:return 2;case 9:case 10:return 3;case 11:case 12:return 4;case 13:case 14:return 5;case 15:return 6;case 16:case 17:return 7;default:return 0}}function bonusMap(e,t){let a=e[0],r=e[1],n=e[2],c=e[3],s=e[4],i=e[5];switch(t){case 0:return Math.floor((r+n)/2);case 1:return s;case 2:return Math.floor((s+c)/2);case 3:return Math.floor((a+n)/2);case 4:return i;case 5:return s;case 6:return i;case 7:return Math.floor((r+c)/2);case 8:return c;case 9:return Math.floor((s+a)/2);case 10:return s;case 11:return Math.floor((c+s)/2);case 12:return c;case 13:return s;case 14:return i;case 15:return r;case 16:return c;case 17:return r;case 18:return s;case 19:return Math.floor((c+s)/2);case 20:return a}}function updateTitle(){characterSave.name.replace(/\s/g,"").length?document.querySelector("title").innerText=characterSave.name:document.querySelector("title").innerText="Cleared Waters"}function getCharacter(){let e=window.location.search.split("=")[1];e||window.location.replace("index.html");const t=JSON.parse(localStorage.getItem("characterList"));let a;for(const r in t)if(t[r].info.uuid==e){a=r;break}loadCharacter(t[a])}function saveCharacter(e){let t=window.location.search.split("=")[1];t||window.location.replace("index.html");const a=JSON.parse(localStorage.getItem("characterList"));let r;for(const e in a)if(a[e].info.uuid==t){r=e;break}a[r]=characterSave,localStorage.setItem("characterList",JSON.stringify(a))}const infoInput=document.querySelector("#info"),characterInput=document.querySelector("#character"),prowessesInput=document.querySelector("#prowesses"),skillsInput=document.querySelector("#skills"),numInput=Array.from(document.querySelectorAll("input[type=number]"));numInput.forEach(e=>{e.addEventListener("keydown",function(e){function t(e,t){return e.indexOf(t)>-1}(1===e.key.length&&!t("-0123456789",e.key)||"."===e.key&&t(e.target.value,"."))&&e.preventDefault()})}),infoInput.addEventListener("input",e=>{characterSave[e.target.id]=e.target.value,updateTitle(),saveCharacter(characterSave)}),characterInput.addEventListener("input",e=>{"wounds"==e.target.parentElement.parentElement.id?characterSave.wounds[e.target.parentElement.id][e.target.getAttribute("index")]=e.target.value:"stats"==e.target.parentElement.parentElement.id?e.target.value<-7||e.target.value>17||(characterSave.stats[e.target.id]=e.target.value,calcStats()):characterSave[e.target.id]=e.target.value,saveCharacter(characterSave)}),prowessesInput.addEventListener("input",e=>{"statisticalTraining"==e.target.parentElement.id?characterSave.statisticalTraining[e.target.className]=e.target.value:characterSave[e.target.id]=e.target.value,saveCharacter(characterSave)}),skillsInput.addEventListener("input",e=>{let t=e.target.getAttribute("index").split(" ");characterSave.skills[Number(t[0])][Number(t[1])]=e.target.checked,saveCharacter(characterSave)});const nav=document.getElementById("ui"),characterPages={character:document.getElementById("character"),prowesses:document.getElementById("prowesses"),skills:document.getElementById("skills"),setAll:e=>{characterPages.character.style.display=e,characterPages.prowesses.style.display=e,characterPages.skills.style.display=e}};function downloadCharacter(e,t){var a=new Blob([t],{type:"text/csv"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(a,e);else{var r=window.document.createElement("a");r.href=window.URL.createObjectURL(a),r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)}}function setTheme(e){localStorage.setItem("theme",e),document.documentElement.setAttribute("theme",e)}function toggleTheme(){"theme-dark"===localStorage.getItem("theme")?(setTheme("theme-light"),document.querySelector("#sun").style.display="none",document.querySelector("#moon").style.display="block"):(setTheme("theme-dark"),document.querySelector("#sun").style.display="block",document.querySelector("#moon").style.display="none")}function download(e){}characterPages.setAll("none"),characterPages.character.style.display="grid",nav.addEventListener("click",e=>{let t;null!=(t="svg"==e.target.tagName?e.target.parentElement.id:"path"==e.target.tagName?e.target.parentElement.parentElement.id:e.target.id)&&("theme"==t?toggleTheme():"characterS"==t?(characterPages.setAll("none"),characterPages.character.style.display="grid"):"prowessesS"==t?(characterPages.setAll("none"),characterPages.prowesses.style.display="grid"):"skillsS"==t?(characterPages.setAll("none"),characterPages.skills.style.display="grid"):"download"==t?downloadCharacter(`${characterSave.name}.character`,JSON.stringify(characterSave)):"home"==t&&(window.location.href="index.html"))}),"theme-dark"===localStorage.getItem("theme")?(setTheme("theme-dark"),document.querySelector("#moon").style.display="none"):(setTheme("theme-light"),document.querySelector("#sun").style.display="none");