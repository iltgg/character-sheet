let character={info:{uuid:"",type:"clc"},name:"",type:"",class:"",apprehension:0,wounds:{fatal:[""],dangers:["",""],pains:["","",""],distractions:["","","",""],annoyances:["","","","",""]},stats:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0},equipment:"",peculiarityPoints:0,statisticalTraining:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0},peculiarityTraining:0,peculiarities:"",recoveringWound:"",weeksRequired:0,skills:[[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]]};const selection=document.getElementById("selection");function loadCharacters(){let e=JSON.parse(localStorage.getItem("characterList"));if(e){selection.innerHTML="";for(const t of e)displayCharacter(t)}e.forEach(e=>{e.info.new=!1}),localStorage.setItem("characterList",JSON.stringify(e))}function displayCharacter(e){const t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),i=document.createElement("a");t.className="character",t.setAttribute("uuid",e.info.uuid),a.className="character-info",n.className="name",r.className="type",o.className="class",l.className="buttons",i.className="character-link",n.innerText=e.name,r.innerText=e.type,o.innerText=e.class,i.setAttribute("href",`character-sheet.html?character=${e.info.uuid}`),l.innerHTML='<input type="button" value="download" class="download"><input type="button" value="delete" class="delete">',a.appendChild(n),a.appendChild(r),a.appendChild(o),t.appendChild(a),t.appendChild(l),t.appendChild(i),!0===e.info.new&&(t.className+=" animate-new"),selection.appendChild(t)}function nukeAll(){!0===confirm("Are you sure you want to delete all characters? This cannot be undone")?(localStorage.removeItem("characterList"),console.log("All characters deleted"),window.location.reload()):console.log("Cancelled")}function newCharacter(){currentList=JSON.parse(localStorage.getItem("characterList")),character.info.uuid=createUUID(),character.info.new=!0,currentList||(currentList=[]),currentList.push(character),localStorage.setItem("characterList",JSON.stringify(currentList)),character.info.uuid="",loadCharacters()}function createUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}document.body.onload=(()=>{loadCharacters()});const upload=document.getElementById("input");function uploadCharacter(e){let t=this.files;if(t||(t=e),t){let e=t.length;for(const a of t){const t=new Blob([a]);t.text();t.text().then(t=>{let a=JSON.parse(localStorage.getItem("characterList")),n=JSON.parse(t);if(n.info.new=!0,a){let e=n.info.uuid;a.push(n);for(let t=0;t<a.length-1;t++)a[t].info.uuid==e&&(a[t]=n,a.pop());localStorage.setItem("characterList",JSON.stringify(a))}else(a=[]).push(n),localStorage.setItem("characterList",JSON.stringify(a));0==--e&&loadCharacters()})}}}function downloadCharacter(e,t){var a=new Blob([t],{type:"text/csv"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(a,e);else{var n=window.document.createElement("a");n.href=window.URL.createObjectURL(a),n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}}upload.addEventListener("change",uploadCharacter),selection.addEventListener("click",e=>{let t=e.target.className;if("delete"==t){if(confirm(`Are you sure you want to delete ${e.target.parentElement.parentElement.getElementsByClassName("character-info").item("0").getElementsByClassName("name").item("0").innerText}`)){let t=JSON.parse(localStorage.getItem("characterList"));const a=e.target.parentElement.parentElement.getAttribute("uuid");for(const e in t)if(t[e].info.uuid==a){t.splice(e,1);break}localStorage.setItem("characterList",JSON.stringify(t)),loadCharacters()}}else if("download"==t){let t=JSON.parse(localStorage.getItem("characterList"));const a=e.target.parentElement.parentElement.getAttribute("uuid"),n=e.target.parentElement.parentElement.getElementsByClassName("character-info").item("0").getElementsByClassName("name").item("0").innerText;for(const e in t)if(t[e].info.uuid==a){downloadCharacter(`${n}.character`,JSON.stringify(t[e]));break}}}),selection.addEventListener("dragenter",e=>{e.stopPropagation(),e.preventDefault(),selection.classList.add("dragging")},!1),selection.addEventListener("dragover",e=>{e.stopPropagation(),e.preventDefault()},!1),selection.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),selection.classList.remove("dragging"),uploadCharacter(e.dataTransfer.files)},!1),selection.addEventListener("dragleave",e=>{e.stopPropagation(),e.preventDefault(),selection.classList.remove("dragging")},!1);const nav=document.querySelector("body");nav.addEventListener("click",e=>{let t;null!=(t="svg"==e.target.tagName?e.target.parentElement.id:"path"==e.target.tagName?e.target.parentElement.parentElement.id:"info-block"==e.target.className?"info":e.target.id)&&("theme"==t?toggleTheme():"new"==t?newCharacter():"info"==t&&toggleInfo())});const info=document.querySelector(".info-block");let toggled=!1;function toggleInfo(){toggled?(info.style.display="none",info.children.item("0").style.display="none",toggled=!toggled):(info.style.display="block",info.children.item("0").style.display="block",toggled=!toggled)}function setTheme(e){localStorage.setItem("theme",e),document.documentElement.setAttribute("theme",e)}function toggleTheme(){"theme-dark"===localStorage.getItem("theme")?(setTheme("theme-light"),document.querySelector("#sun").style.display="none",document.querySelector("#moon").style.display="block"):(setTheme("theme-dark"),document.querySelector("#sun").style.display="block",document.querySelector("#moon").style.display="none")}"theme-dark"===localStorage.getItem("theme")?(setTheme("theme-dark"),document.querySelector("#moon").style.display="none"):(setTheme("theme-light"),document.querySelector("#sun").style.display="none");